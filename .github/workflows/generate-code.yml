jobs:
  build:
    runs-on: self-hosted
    steps:
    - continue-on-error: true
      name: Setup
      uses: actions/checkout@v4
      with:
        submodules: recursive
    - continue-on-error: true
      name: Update submodules
      run: git submodule update --remote --recursive
    - continue-on-error: true
      name: Set up Java
      uses: actions/setup-java@v4
      with:
        architecture: x64
        distribution: temurin
        java-version: 17
    - continue-on-error: true
      name: Generate code
      run: 'python generate-code.py


        diff=$(git --no-pager diff --name-only HEAD)

        echo "DIFF_IS_EMPTY=$([[ -z "$diff" ]] && echo ''true'' || echo ''false'')"
        >> $GITHUB_ENV

        echo "CURRENT_DATETIME=$(date +''%Y%m%d%H%M%S'')" >> $GITHUB_ENV

        '
    - continue-on-error: true
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      if: ${{ env.DIFF_IS_EMPTY != 'true' }}
      run: 'git config user.name github-actions

        git config user.email github-actions@github.com

        git checkout -b update-diff-${{ env.CURRENT_DATETIME }}


        git add .

        git commit -m "Code are generated by openapi generator"

        git push origin update-diff-${{ env.CURRENT_DATETIME }}


        gh pr create -B ${{ github.ref_name }} -t "Codes are generated by openapi
        generator" -b "" --label "line-openapi-update"

        '
name: Generate code and open pull request
on:
  repository_dispatch:
    types: trigger-ga___generate-code.yml
